#!/bin/bash

# Obtain directory where this file resides.
PWD=`pwd`
SELF=`dirname ${BASH_SOURCE[0]}`
cd $SELF
SELF=`pwd`
cd $PWD

# Include libs!
. "$SELF/inc/lib.sh"

for dotfile in $(dotfiles $SELF); do
    BACKUP=false

    # Detect if there's a file already there.
    if [[ -f ~/.$dotfile ]]; then

        # is it a symlink? is it poiting to this dir?
        if [ -L ~/.$dotfile -a `readlink ~/.$dotfile | xargs dirname $1` == $SELF ]; then
            echo "~/.$dotfile already existed."
            continue
        # ok, nothing to do with us, better make a backup.
        else
            mv ~/.$dotfile ~/.$dotfile.orig
            BACKUP=true
        fi
    fi

    ln -s $SELF/$dotfile.sh ~/.$dotfile
    printf "Symlinked $dotfile. "
    if $BACKUP; then
        printf "(A backup was saved)."
    fi
    echo
done

. "$SELF/inc/install.sh"
