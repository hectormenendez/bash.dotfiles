#!/bin/bash

# Sources utils only if they are not already available
[[ ! $DOTFILES_LIB ]] && echo >&2 "Expecting DOTFILES environment" && exit 1
source $DOTFILES_LIB/utils.sh

ignorelist=( '.dropbox' '.Trash' , '.ssh', '.terminfo', '.cache'w)

for dotfile in `find $HOME -maxdepth 1 -name ".*" ! -type l ! -path $HOME`; do
	dotfile=${dotfile/$HOME\//}
	# ignored listed files
	isListed $dotfile ${ignorelist[@]} && continue
	# dont overwrite
	[[ -e $DOTFILES_LNK/$dotfile ]] && continue
	cd $HOME
	mv $HOME/$dotfile $DOTFILES_LNK/
	ln -s ${DOTFILES_LNK/$HOME\//}/$dotfile ./$dotfile
	# OCT is my burden
	isDarwin && /bin/chmod -h 700 ./$dotfile
done
